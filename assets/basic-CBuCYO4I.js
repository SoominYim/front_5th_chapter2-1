import"./modulepreload-polyfill-B5Qt9EMX.js";const u={FLASH_SALE:{INTERVAL:3e4,CHANCE:.3,DISCOUNT:.2},RECOMMENDATION_SALE:{INTERVAL:6e4,DISCOUNT:.05}},L={DISCOUNT_RATE:{p1:.1,p2:.15,p3:.2,p4:.05,p5:.25}},h=[{id:"p1",name:"상품1",price:1e4,stock:50},{id:"p2",name:"상품2",price:2e4,stock:30},{id:"p3",name:"상품3",price:3e4,stock:20},{id:"p4",name:"상품4",price:15e3,stock:0},{id:"p5",name:"상품5",price:25e3,stock:10}],l={},n={lastSelected:null,products:JSON.parse(JSON.stringify(h)),totalAmount:0,discountRate:0,cartCount:0,cartList:[],set(t,e){this[t]=e,l[t]&&l[t].forEach(s=>s(e))},subscribe(t,e){l[t]||(l[t]=[]),l[t].push(e)}},m=(t,e,s)=>{document.querySelectorAll(t).forEach(r=>r.addEventListener(e,s))},T=(t,e)=>e>=10&&L.DISCOUNT_RATE[t]?L.DISCOUNT_RATE[t]:0,b=()=>{let t=0,e=0;const s=n.cartList;let c=0,r=0;s.forEach(o=>{const d=n.products.find(({id:S})=>S===o.id);if(!d)return;const a=o.quantity,i=d.price*a,p=T(o.id,a);t+=i*(1-p),e+=a,c+=i}),{totalAmount:t,discountRate:r}=g(t,e,c,r),{totalAmount:t,discountRate:r}=A(t,r),n.set("totalAmount",t),n.set("discountRate",r),n.set("cartCount",e)},g=(t,e,s,c)=>{if(s===0)return{totalAmount:t,discountRate:c};if(c=(s-t)/s,e>=30){const r=s*.25,o=s-t;r>o&&(t=s*(1-.25),c=.25)}return{totalAmount:t,discountRate:c}},A=(t,e)=>(new Date().getDay()===2&&(t*=1-.1,e=Math.max(e,.1)),{totalAmount:t,discountRate:e}),C=t=>{const e=n.products,s=n.cartList,c=e.find(({id:o})=>o===t),r=s.find(({id:o})=>o===t);if(!c||c.stock<1){alert("재고가 부족합니다.");return}c.stock--,r?(r.price+=c.price,r.quantity++):s.push({id:c.id,name:c.name,price:c.price,quantity:1}),n.set("products",[...e]),n.set("cartList",[...s]),b()},N=()=>{const t=document.querySelector("#product-select").value;C(t)},$=t=>{const e=t.target.dataset.productId;C(e)},x=t=>{const e=n.products,s=n.cartList,c=t.target.dataset.productId,r=e.find(({id:d})=>d===c),o=s.find(({id:d})=>d===c);if(o.quantity--,r.stock++,o.quantity===0){const d=s.filter(({id:a})=>a!==c);n.set("cartList",d)}else n.set("cartList",[...s]);n.set("products",[...e]),b()},y=t=>{const e=n.products,s=n.cartList,c=t.target.dataset.productId,r=e.find(({id:a})=>a===c),o=s.find(({id:a})=>a===c);r.stock+=o.quantity;const d=s.filter(({id:a})=>a!==c);n.set("cartList",d),n.set("products",[...e]),b()},I=()=>{const t=Object.assign(document.createElement("div"),{id:"cart-items",className:"my-4"}),e=()=>{const s=n.cartList,c=n.products;t.innerHTML=`${s.map(({id:r,name:o,_:d,quantity:a})=>{var i;return`<div id="${r}" class="flex justify-between items-center mb-2">
              <span>${o} - ${(i=c.find(({id:p})=>p===p))==null?void 0:i.price}원 x ${a}</span>
              <div>
                <button class="quantity-change bg-blue-500 text-white px-2 py-1 rounded mr-1" data-product-id="${r}" data-change="-1">-</button>
                <button class="quantity-change bg-blue-500 text-white px-2 py-1 rounded mr-1" data-product-id="${r}" data-change="1">+</button>
                <button class="remove-item bg-red-500 text-white px-2 py-1 rounded" data-product-id="${r}">삭제</button>
              </div>
            </div>
          `}).join("")}`,m('button[data-change="1"]',"click",$),m('button[data-change="-1"]',"click",x),m(".remove-item","click",y)};return n.subscribe("cartList",e),e(),t},k=(t=h)=>{const e=Object.assign(document.createElement("select"),{id:"product-select",className:"border rounded p-2 mr-2"});return(()=>{e.innerHTML=`
      ${t.map(c=>`<option value="${c.id}" ${c.stock===0?"disabled":""}>${c.name} - ${c.price}원</option>`).join("")}
  `})(),e},v=()=>{const t=Object.assign(document.createElement("div"),{id:"stock-status",className:"text-sm text-gray-500 mt-2"}),e=()=>{const s=n.products;t.innerHTML=`${s.filter(c=>c.stock<5).map(c=>`${c.name}: ${c.stock>0?`재고 부족 (${c.stock}개 남음)`:"품절"}`)}`};return e(),n.subscribe("products",e),t},O=()=>{const t=Object.assign(document.createElement("button"),{id:"add-to-cart",className:"bg-blue-500 text-white px-4 py-2 rounded",textContent:"추가"});return(()=>{t.textContent="추가",t.addEventListener("click",N)})(),t},M=()=>{const t=Object.assign(document.createElement("div"),{id:"cart-total",className:"text-xl font-bold my-4"}),e=()=>{const s=n.totalAmount,c=n.discountRate,r=Math.floor(s/1e3);return t.innerHTML=`총액: ${s}원${c>0?`<span class="text-green-500 ml-2">(${(c*100).toFixed(1)}% 할인 적용)</span>`:""}<span id="loyalty-points" class="text-blue-500 ml-2">(포인트: ${r})</span></div>
  `,t};return e(),n.subscribe("totalAmount",e),n.subscribe("discountRate",e),t},E=(t,e,s)=>{setTimeout(()=>{setInterval(e,t)},s)},D=()=>{E(u.FLASH_SALE.INTERVAL,()=>{const t=n.products[Math.floor(Math.random()*n.products.length)];Math.random()<u.FLASH_SALE.CHANCE&&t.stock>0&&(t.price=Math.round(t.price*(1-u.FLASH_SALE.DISCOUNT)),alert("번개세일! "+t.name+"이(가) 20% 할인 중입니다!"))},Math.random()*1e4),E(u.RECOMMENDATION_SALE.INTERVAL,()=>{if(n.lastSelected){const t=n.products.find(function(e){return e.id!==n.lastSelected&&e.stock>0});t&&(alert(t.name+"은(는) 어떠세요? 지금 구매하시면 5% 추가 할인!"),t.price=Math.round(t.price*(1-u.RECOMMENDATION_SALE.DISCOUNT)))}},Math.random()*2e4)},f=document.getElementById("app");function R(){f.innerHTML=`
  <div class="bg-gray-100 p-8">
    <div id="wrap" class="max-w-md mx-auto bg-white rounded-xl shadow-md overflow-hidden md:max-w-2xl p-8">
      <h1 class="text-2xl font-bold mb-4">장바구니</h1>
    </div>
  </div>
`;const t=f.querySelector("#wrap");(()=>{t.append(I(),M(),k(),O(),v())})(),D()}const w=()=>{R()};w();
